<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../juicy-html/juicy-html.html">
<link rel="import" href="responsive-grid-row.html">
<link rel="import" href="responsive-grid-col.html">
<link rel="import" href="responsive-grid-clear.html">

<!--
`responsive-grid`
A LRN element

@demo demo/index.html

@microcopy - the mental model for this element
 Example:
  <responsive-grid>
    <responsive-grid-row>
      <responsive-grid-col large="4" desktop="3" tablet="2" mobile="1">Content</responsive-grid-col>
      <responsive-grid-col large="4" desktop="3" tablet="2" mobile="1">Content</responsive-grid-col>
      <responsive-grid-col large="4" desktop="3" tablet="2" mobile="1">Content</responsive-grid-col>
      <responsive-grid-col large="4" desktop="3" tablet="2" mobile="1">Content</responsive-grid-col>
    </responsive-grid-row>
  </responsive-grid>

-->

<dom-module id="responsive-grid">
  <template>
    <style>
      :host {
        display: block;
        margin-right: auto;
        margin-left: auto;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }
      :host:before,
      :host:after {
        content: " ";
        display: table;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }
      :host:after {
        clear: both;
      }
      /* Hide Print-Only on Screen */
      @media screen {
        ::slotted(responsive-grid-row[print-only]),
        ::slotted(* > responsive-grid-col[print-only]) {
          display: none;
        }
      }
      /* Hide Screen-Only on Print */
      @media print {
        ::slotted(* > responsive-grid-col[screen-only]) {
          display: none;
        }
      }
      </style>
      <template is="dom-bind">
        <juicy-html model="{{model}}" html="{{model.html}}"></juicy-html>
      </template>
      <slot></slot>
  </template>

  <script>
    Polymer({

      is: 'responsive-grid',

      properties: {
        /**
         * Set small breakpoint
         */
         sm: {
          type: Number,
          value: 600,
        },
        /**
         * Set medium breakpoint
         */
         md: {
          type: Number,
          value: 900,
        },
        /**
         * Set small breakpoint
         */
         lg: {
          type: Number,
          value: 1200,
        },
        /**
         * Set medium breakpoint
         */
         xl: {
          type: Number,
          value: 1800,
        },
        /**
         * Stylesheet based on breakpoints. Breakpoints selected based on: 
         * https://medium.freecodecamp.org/the-100-correct-way-to-do-css-breakpoints-88d6a5ba1862 
         */
         model: {
          type: Object,
          computed: '_getHTML(sm,md,lg,xl)',
        },
      },
      /**
       * Calculate the html to inlcude.
       */
      _getHTML: function(sm,md,lg,xl) {
        let html = [
          this._getMedia('xs','block'),
          '@media (min-width: '+sm+'px) {'+this._getHiddenCol('xs','block')+this._getMedia('sm')+'}',
          '@media (min-width: '+md+'px) {'+this._getHiddenCol('md','block')+this._getMedia('md')+'}',
          '@media (min-width: '+lg+'px) {'+this._getHiddenCol('lg','block')+this._getMedia('lg')+'}',
          '@media (min-width: '+xl+'px) {'+this._getHiddenCol('xl','block')+this._getMedia('xl')+'}'
        ];
        console.log('<style>'+html.join('')+'<style>');
        return {'html': '<style>'+html.join('')+'<style>'};
      },
      /**
       * Calculate the CSS for a media query.
       */
      _getMedia: function(size) {
        let css = '', cols = [
          [12,100],[11,91.66666667],[10,83.33333333],
          [9,75],[8,66.66666667],[7,58.33333333],
          [6,50],[5,41.66666667],[4,33.33333333],
          [3,25],[2,16.66666667],[1,8.33333333]
        ];
        for (i in cols) {
          css+= this._getCSS(size,cols[i][0],cols[i][1]);
        }
        css+= this._getHiddenCol(size,'none');
        return css;
      },
      /**
       * Calculate the CSS for a single column at a breakpoint.
       */
      _getCSS: function(size,width,pct) {
        return 'responsive-grid-col['+size+'-width="'+width+'"] { width: '+pct+'%; }';
      },
      /**
       * Show or hide a column with width 0.
       */
      _getHiddenCol: function(size,display) {
        return 'responsive-grid-col['+size+'-width="0"] { display: '+display+'; }';
      },
    });
  </script>
</dom-module>
